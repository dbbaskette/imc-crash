server:
  port: 8085

spring:
  application:
    name: crash-communications
  
  # Database configuration for demo mode message storage
  datasource:
    url: jdbc:postgresql://${DB_HOST:postgres}:${DB_PORT:5432}/${DB_NAME:crashdb}
    username: ${DB_USER:crashuser}
    password: ${DB_PASSWORD:crashpass}
    driver-class-name: org.postgresql.Driver
  
  jpa:
    hibernate:
      ddl-auto: validate  # Schema managed by init-schema.sql
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
  
  ai:
    mcp:
      server:
        name: communications-agent
        version: 1.0.0
        type: SYNC
        protocol: STATELESS
        stateless:
          mcp-endpoint: /mcp
        instructions: |
          Communications Agent - Handles driver and adjuster communications.

          Available tools:
          - send_sms: Send SMS message to driver (mentions email will follow)
          - send_push_notification: Send push notification via mobile app
          - notify_adjuster: Notify claims adjuster about new claim
          - send_fnol_email: Send FNOL report email to claims adjuster with full details
          - send_customer_followup_email: Send follow-up email to customer with claim details,
            service recommendations (body shops, tow, rentals, medical), and next steps.
            Call this AFTER gathering service locations from the Services agent.
          - dispatch_roadside_assistance: Dispatch roadside assistance
          - log_communication_event: Log communication for audit trail
          - get_full_communications_status: Get complete communication status
        capabilities:
          tool: true
          resource: false
          prompt: false

# Twilio Configuration
twilio:
  account-sid: ${TWILIO_ACCOUNT_SID:}
  auth-token: ${TWILIO_AUTH_TOKEN:}
  from-number: ${TWILIO_FROM_NUMBER:}
  test-to-number: ${TWILIO_TEST_TO_NUMBER:}  # Optional override for all SMS recipients

# Gmail SMTP Configuration
gmail:
  username: ${GMAIL_USERNAME:}
  app-password: ${GMAIL_APP_PASSWORD:}
  adjuster-email: ${GMAIL_ADJUSTER_EMAIL:}
  customer-email: ${GMAIL_CUSTOMER_EMAIL:}  # For demo: all customer emails go to this address

# Demo Mode Configuration
# When enabled, emails and SMS are stored in database instead of being sent
demo:
  mode: ${DEMO_MODE:false}

spring.mail:
  host: smtp.gmail.com
  port: 587
  username: ${GMAIL_USERNAME:}
  password: ${GMAIL_APP_PASSWORD:}
  properties:
    mail:
      smtp:
        auth: true
        starttls:
          enable: true
          required: true

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always
  health:
    mail:
      enabled: false

logging:
  level:
    com.insurancemegacorp.crash: DEBUG
    org.springframework.ai.mcp: DEBUG
